<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
       



        function axios({ method = 'GET', url, params = {}, data = {}, header = {} }) {

            return new Promise(function (resolve, reject) {
                const xhr = new XMLHttpRequest()

                if (Object.keys(params).length) {
                    url = url + '?' + handleParams(params)
                }







                // 1. 开启请求
                xhr.open(method, url)
                if (/post/i.test(method)) {
                    if (/json/i.test(header['Content-Type'])) {
                        // json格式，则data转json字符串
                        data = JSON.stringify(data)
                        xhr.setRequestHeader('Content-Type', 'application/json')
                    } else if (!(data instanceof FormData)) {
                        // FormData格式不需要处理 只需要传递formData的实例即可
                        // data不是form-data，又不是json，则当做 查询字符串格式
                        // [xml格式已废弃，不考虑实现] 
                        data = handleParams(data)//查询字符串格式
                        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')

                    }
                }






                // 2. 发起请求
            

                xhr.send(JSON.stringify(data)) //发起请求并携带数据
                // 监听xhr状态
                xhr.onreadystatechange = function () {
                    console.log(11, xhr.responseText);
                    // 错误的
                    // if (xhr.readyState === 4 & xhr.status === 200) {
                    //     console.log(xhr.responseText)
                    //     resolve(xhr.responseText);
                    // } else {
                    //     console.log('走失败分支')
                    //     reject(xhr.statusText);
                    // }
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200 || xhr.status === 304) {
                            resolve({
                                data: JSON.parse(xhr.responseText),
                                config: '等等可以继续模拟其他axios添加的内容',
                            })
                        } else {
                            reject(xhr.statusText)
                        }
                    }

                }

            })

        }

         function handleParams(obj) {
                const arr = []
                for (const key in obj) {
                    arr.push(`${key}=${obj[key]}`)
                }

                return arr.join('&')
            }

        const p1 = axios({
            method: 'GET',
            url: 'http://www.liulongbin.top:3006/api/getBooks',
            params: {},
            data: {},
            header: ''
        })
        p1.then(data => {
            console.log('成功的回调', data.data.data);
        }).catch(err => {
            console.log('失败的回调', err);
        })




    </script>
</body>

</html>